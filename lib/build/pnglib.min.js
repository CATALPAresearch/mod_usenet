/**
* A handy class to calculate color values.
*
* @version 1.0
* @author Robert Eisele <robert@xarg.org>
* @copyright Copyright (c) 2010, Robert Eisele
* @link http://www.xarg.org/2010/03/generate-client-side-png-files-using-javascript/
* @license http://www.opensource.org/licenses/bsd-license.php BSD License
*
*/
!function(){function i(i,t){for(var s=2;s<arguments.length;s++)for(var h=0;h<arguments[s].length;h++)i[t++]=arguments[s].charAt(h)}function t(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,255&i)}function s(i){return String.fromCharCode(255&i,i>>8&255)}var h=function(h,f,e){this.width=h,this.height=f,this.depth=e,this.pix_size=f*(h+1),this.data_size=2+this.pix_size+5*Math.floor((65534+this.pix_size)/65535)+4,this.ihdr_offs=0,this.ihdr_size=25,this.plte_offs=this.ihdr_offs+this.ihdr_size,this.plte_size=8+3*e+4,this.trns_offs=this.plte_offs+this.plte_size,this.trns_size=8+e+4,this.idat_offs=this.trns_offs+this.trns_size,this.idat_size=8+this.data_size+4,this.iend_offs=this.idat_offs+this.idat_size,this.iend_size=12,this.buffer_size=this.iend_offs+this.iend_size,this.buffer=new Array,this.palette=new Object,this.pindex=0;for(var r=new Array,o=0;o<this.buffer_size;o++)this.buffer[o]="\0";i(this.buffer,this.ihdr_offs,t(this.ihdr_size-12),"IHDR",t(h),t(f),"\b"),i(this.buffer,this.plte_offs,t(this.plte_size-12),"PLTE"),i(this.buffer,this.trns_offs,t(this.trns_size-12),"tRNS"),i(this.buffer,this.idat_offs,t(this.idat_size-12),"IDAT"),i(this.buffer,this.iend_offs,t(this.iend_size-12),"IEND");var n,d=30912;d+=31-d%31,i(this.buffer,this.idat_offs+8,(n=d,String.fromCharCode(n>>8&255,255&n)));for(o=0;(o<<16)-1<this.pix_size;o++){var a,_;o+65535<this.pix_size?(a=65535,_="\0"):(a=this.pix_size-(o<<16)-o,_=""),i(this.buffer,this.idat_offs+8+2+(o<<16)+(o<<2),_,s(a),s(~a))}for(o=0;o<256;o++){for(var u=o,p=0;p<8;p++)u=1&u?-306674912^u>>1&2147483647:u>>1&2147483647;r[o]=u}this.index=function(i,t){var s=t*(this.width+1)+i+1;return this.idat_offs+8+2+5*Math.floor(s/65535+1)+s},this.color=function(i,t,s,h){var f=(((h=h>=0?h:255)<<8|i)<<8|t)<<8|s;if(void 0===this.palette[f]){if(this.pindex==this.depth)return"\0";var e=this.plte_offs+8+3*this.pindex;this.buffer[e+0]=String.fromCharCode(i),this.buffer[e+1]=String.fromCharCode(t),this.buffer[e+2]=String.fromCharCode(s),this.buffer[this.trns_offs+8+this.pindex]=String.fromCharCode(h),this.palette[f]=String.fromCharCode(this.pindex++)}return this.palette[f]},this.getBase64=function(){var i,t,s,h,f,e,r,o=this.getDump(),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=o.length,a=0,_="";do{h=(i=o.charCodeAt(a))>>2,f=(3&i)<<4|(t=o.charCodeAt(a+1))>>4,s=o.charCodeAt(a+2),e=d<a+2?64:(15&t)<<2|s>>6,r=d<a+3?64:63&s,_+=n.charAt(h)+n.charAt(f)+n.charAt(e)+n.charAt(r)}while((a+=3)<d);return _},this.getDump=function(){for(var s=1,h=0,f=5552,e=0;e<this.height;e++)for(var o=-1;o<this.width;o++)h+=s+=this.buffer[this.index(o,e)].charCodeAt(0),0==(f-=1)&&(s%=65521,h%=65521,f=5552);function n(s,h,f){for(var e=-1,o=4;o<f-4;o+=1)e=r[255&(e^s[h+o].charCodeAt(0))]^e>>8&16777215;i(s,h+f-4,t(-1^e))}return s%=65521,h%=65521,i(this.buffer,this.idat_offs+this.idat_size-8,t(h<<16|s)),n(this.buffer,this.ihdr_offs,this.ihdr_size),n(this.buffer,this.plte_offs,this.plte_size),n(this.buffer,this.trns_offs,this.trns_size),n(this.buffer,this.idat_offs,this.idat_size),n(this.buffer,this.iend_offs,this.iend_size),"Â‰PNG\r\n\n"+this.buffer.join("")}};"undefined"!=typeof module&&void 0!==module.exports?module.exports=h:window.PNGlib=h}();