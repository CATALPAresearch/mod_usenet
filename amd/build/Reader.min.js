/**
 * Newsgroup reader
 * @module     mod/newsmod/Reader
 * @class      newsmod
 * @copyright  2020 Niels Seidel <niels.seidel@fernuni-hagen.de>
 * @license    MIT
 * @since      3.1
 */
<<<<<<< HEAD
define(["jquery",M.cfg.wwwroot+"/mod/newsmod/lib/build/vue.min.js",M.cfg.wwwroot+"/mod/newsmod/lib/build/axios.min.js",M.cfg.wwwroot+"/mod/newsmod/lib/build/identicon.min.js",M.cfg.wwwroot+"/mod/newsmod/amd/src/ReaderMessageBody.js",M.cfg.wwwroot+"/mod/newsmod/amd/src/ReaderPostContainer.js",M.cfg.wwwroot+"/mod/newsmod/amd/src/VizBubble.js"],(function(e,t,s,i,n,o,a){return function(r,d,c,h){var l=new t({el:"newsmod-container",data:function(){return{instanceName:"Newsgroup",showMessageBody:!1,searchstring:"",searchresult:[],hiddenposts:[],filter_assessment:!0,filter_text:!0,content:[],tree_data:"",treedata_viz:{},sequence:1,arraypos:0,post_list:[],post_list_section:[],post_list_section_size:0,singlepostdata:[],msgbodycontainerdisplay:"none",isreading:!1,isanswering:!1,iscreatingtopic:!1,markedpost:-1,courseid:d,hideloadingicon:!0,hideloadingiconRMB:!0,identiconstring:"",viewportsize:"none",showmodal:!1,displayerrormsg:!1,newsgroup_name:"",newsgroup_postquantity:0,fetch_postquantity:50,start:"0",end:"0",errorMessages:[],searchresultmsg:"",statesearchresult:!1,statesRMB:{CanSelectNext:!0,CanSelectPrev:!0}}},components:{"messagebody-container":n,"post-container":o,"viz-bubble":a},created:function(){this.instanceName=h,this.singlepostdata.header={name:"",subject:""},r.add("hello_world",{level:"fun",target:"vue is in place"}),e(".nav-link-h4").click((function(){r.add("toc_entry_open",{level:"h4",target:e(this).attr("href")})})),e(".nav-link-h3").click((function(){r.add("toc_entry_open",{level:"h3",target:e(this).attr("href")})})),window.addEventListener("resize",this.Windowresizehandler),Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)<576?this.viewportsize="mobile":this.viewportsize="other"},destroyed(){window.removeEventListener("resize",this.Windowresizehandler)},mounted:function(){this.hideloadingicon=!1,this.initiatecontact()},computed:{},methods:{hideMessageBody:function(){this.showMessageBody=!1},Windowresizehandler:function(){Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)<576?(this.viewportsize="mobile",""==this.msgbodycontainerdisplay&&(this.showmodal=!0)):(this.viewportsize="other",this.showmodal=!1)},initiatecontact:function(){this.getgroupinfo().then((function(e){s.get(M.cfg.wwwroot+"/mod/newsmod/php/fetchtree.php?id="+d+"&start="+l.start+"&end="+l.end).then((function(e){l.check_for_error(e.data)?l.errorMessages.push(e.data):(l.treedata_viz=e.data.children,l.info=e,l.tree_data=e.data,l.buildtree(e.data,1))})).catch((function(e){console.error(e)})).then((function(){l.hideloadingicon=!0}))}))},getgroupinfo:function(){return s.get(M.cfg.wwwroot+"/mod/newsmod/php/groupinfo.php?id="+d).then((function(e){l.check_for_error(e.data)?l.errorMessages.push(e.data):l.processgroupinfo(e.data)})).catch((function(e){console.error(e)}))},processgroupinfo:function(e){l.newsgroup_name=e.groupname,l.newsgroup_postquantity=e.lastarticle-e.firstarticle+1,l.start=parseInt(e.firstarticle),l.end=parseInt(e.lastarticle)},getMessageTree:function(){return this.tree_data.children},findinarr:function(e,t){for(let s=0;s<t.length;s++)if(t[s].messagenumber===e)return t[s]},ondisplaymsg:function(e){this.showMessageBody=!0,this.hideloadingiconRMB=!1,s.get(M.cfg.wwwroot+"/mod/newsmod/php/messageid.php?id="+d+"&msgnr="+e).then((function(e){l.check_for_error(e.data)?l.errorMessages.push(e.data):(l.singlepostdata=e.data,l.identiconstring=l.getidenticon(l.singlepostdata.header.from+l.singlepostdata.header.name))})).catch((function(e){console.error(e)})).then((function(){l.hideloadingiconRMB=!0})),this.msgbodycontainerdisplay="",this.iscreatingtopic=!1,this.isreading=!0,this.isanswering=!1;let t=this.findinarr(e,this.post_list).arraypos;this.markedpost=t,"mobile"==this.viewportsize&&(this.showmodal=!0),this.stateupdateRMB()},setSelected:function(e){this.markedpost=e},onprevmsg:function(e){this.hideloadingiconRMB=!1;let i=this.findinarr(e,this.post_list).arraypos;i-=1,this.markedpost=i,e=this.post_list[i].messagenumber;let n=this.findinarr(e,this.post_list);n.hidden=!1,t.set(this.post_list,i,n),s.get(M.cfg.wwwroot+"/mod/newsmod/php/messageid.php?id="+d+"&msgnr="+e).then((function(e){l.check_for_error(e.data)?l.errorMessages.push(e.data):(l.singlepostdata=e.data,l.identiconstring=l.getidenticon(l.singlepostdata.header.from+l.singlepostdata.header.name))})).catch((function(e){console.error(e)})).then((function(){l.hideloadingiconRMB=!0})),this.msgbodycontainerdisplay="",this.iscreatingtopic=!1,this.isreading=!0,this.isanswering=!1,this.stateupdateRMB()},onnextmsg:function(e){this.hideloadingiconRMB=!1;let i=this.findinarr(e,this.post_list).arraypos;i+=1,this.markedpost=i,e=this.post_list[i].messagenumber;let n=this.findinarr(e,this.post_list);n.hidden=!1,t.set(this.post_list,i,n),s.get(M.cfg.wwwroot+"/mod/newsmod/php/messageid.php?id="+d+"&msgnr="+e).then((function(e){l.check_for_error(e.data)?l.errorMessages.push(e.data):(l.singlepostdata=e.data,l.identiconstring=l.getidenticon(l.singlepostdata.header.from+l.singlepostdata.header.name))})).catch((function(e){console.error(e)})).then((function(){l.hideloadingiconRMB=!0})),this.msgbodycontainerdisplay="",this.iscreatingtopic=!1,this.isreading=!0,this.isanswering=!1,this.stateupdateRMB()},stateupdateRMB:function(){this.markedpost<=0?t.set(this.statesRMB,"CanSelectPrev",!1):t.set(this.statesRMB,"CanSelectPrev",!0),this.markedpost>=this.post_list_section_size-1?t.set(this.statesRMB,"CanSelectNext",!1):t.set(this.statesRMB,"CanSelectNext",!0)},onansweredmsg:function(){this.hideloadingicon=!1,l.post_list.splice(0),this.arraypos=0,this.msgbodycontainerdisplay="none",this.isanswering=!1,this.iscreatingtopic=!1,this.isreading=!1;setTimeout((function(){l.refresh()}),2e3)},prepare_postdata:function(e,t=1){var s,i="0"!=e.markedstatus,n="0"==e.messagestatus,o=!1;if(e.picturestatus>"0")s=M.cfg.wwwroot+"/user/pix.php/"+e.user_id+"/f1.jpg";else{var a={background:[255,255,255,255],margin:.05,size:20,format:"svg"};s=this.getidenticon(e.sender+e.personal)}if(o=!!e.children,!e.children);var r=new Date(e.date);a={year:"numeric",month:"2-digit",day:"2-digit"};r=new Date(e.date).toLocaleDateString("de-DE",a)?new Date(e.date).toLocaleDateString("de-DE",a):"";var d,c=e.personal?e.personal:e.sender;return e.children&&(d=this.getfamily(e)),{marked:i,unread:n,markedhtml:i,picturestatus:e.picturestatus,personal:e.personal,sender:e.sender,user_id:e.user_id,margin:t,sequence:this.sequence++,messageid:e.messageid,messagenumber:e.number,date:e.date,subject:e.name,calctime:r,absender:c,haschild:o,arraypos:this.arraypos++,isSelected:!1,hidden:!1,family:d,identicon:s}},buildtree:function(e,t){void 0===e.children&&console.error("tree_data.children not defined",e),e.children.forEach(e=>{let s=this.prepare_postdata(e,t);this.post_list.push(s),this.post_list_section_size++,e.children&&l.buildtree(e,t+15)})},getfamily:function(e){var t=[];if(e.children){var s=e.children.length;for(let i=0;i<s;i++)t.push(e.children[i].number),e.children[i].children&&t.push(l.getfamily(e.children[i]))}return t},newTopic:function(){this.msgbodycontainerdisplay="",this.showMessageBody=!0,this.iscreatingtopic=!0,this.isreading=!1,this.isanswering=!1},search:function(e){this.hideallposts(),this.statesearchresult=!1,this.hideloadingicon=!1,s.get(M.cfg.wwwroot+"/mod/newsmod/php/search.php?id="+d+"&searchparam="+this.searchstring).then((function(e){l.check_for_error(e.data)?l.errorMessages.push(e.data):l.displaysearchresult("",e.data)})).catch(e=>console.error(e)).then((function(){l.hideloadingicon=!0}))},hideallposts:function(){for(let e=0;e<this.post_list.length;e++){let s=this.post_list[e];s.hidden=!0,t.set(this.post_list,e,s)}},showallposts:function(){for(let e=0;e<this.post_list.length;e++){let s=this.post_list[e];s.hidden=!1,t.set(this.post_list,e,s)}this.statesearchresult=!1},displaysearchresult:function(e,s){this.hideallposts(),this.hiddenposts.splice(0),this.statesearchresult=!0,this.searchresultmsg=s.length;for(let e=0;e<s.length;e++){this.hiddenposts.push(this.findinarr(s[e].messagenumber,this.post_list));let i=this.hiddenposts[e];void 0!==i.hidden?(i.hidden=!1,t.set(this.post_list,i.arraypos,i)):console.error("error displaysearchresult")}},resetsearchstring:function(){this.searchstring="",this.hiddenposts.splice(0),this.displayerrormsg&&(this.post_list.pop(),this.arraypos--,this.displayerrormsg=!1),this.showallposts()},refresh:function(){this.hideloadingicon=!1,this.statesearchresult=!1,this.isreading=!1,this.isanswering=!1,this.msgbodycontainerdisplay="none",this.markedpost=-1,this.arraypos=0,this.post_list.splice(0),"mobile"==this.viewportsize&&(this.showmodal=!1),s.get(M.cfg.wwwroot+"/mod/newsmod/php/phpconn5.php?id="+d).then((function(e){l.check_for_error(e.data)?l.errorMessages.push(e.data):(l.treedata_viz=e.data.children,l.info=e,l.tree_data=e.data,l.buildtree(e.data,1))})).catch((function(e){console.error(e)})).then((function(){l.hideloadingicon=!0}))},getidenticon:function(e){var t=this.hash64(e,!0);return"data:image/svg+xml;base64,"+new i(t,{background:[255,255,255,0],margin:.05,size:20,format:"svg"}).toString()},hash32:function(e,t,s){var i,n,o=void 0===s?2166136261:s;for(i=0,n=e.length;i<n;i++)o^=e.charCodeAt(i),o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24);return t?("0000000"+(o>>>0).toString(16)).substr(-8):o>>>0},hash64:function(e,t){var s=this.hash32(e,t);return s+this.hash32(s+e,t)},check_for_error:function(e){return void 0!==e.is_error},error_to_alert:function(e){l.errorMessages.push()}},template:'\n                <div id="newsmod-container">\n                    <h3 class="mb-4"><img style="width:30px; height:30px;" src="pix/icon.svg"> {{ instanceName }}</h3>\n                    <div class="d-flex">\n                        <div class="d-flex mr-auto">\n                            <button class="btn btn-primary btn-sm" :disabled="iscreatingtopic" v-on:click="newTopic" title="Eine neue Nachricht erstellen">\n                                <i class="fa fa-pen"></i>\n                                Neue Nachricht\n                            </button>\n\n                            <button class="btn btn-light btn-sm" v-on:click="refresh" title="Neue Nachrichten abholen">\n                                    <i class="fa fa-sync"></i>\n                                    <span class="d-none d-md-inline">aktualisieren</span>\n                            </button>\n                        </div>\n                        <div class="search d-flex">\n                            <input \n                                class="form-control form-control-sm d-inline ml-2" \n                                v-model="searchstring" \n                                placeholder="Suchen..." \n                                v-on:keyup.enter="search"\n                                :style="[ viewportsize===\'mobile\' ? {width:70+\'%\'} : {width:150+\'px\'} ]"\n                                >\n\n                            <button class="btn btn-light btn-sm" type="submit" v-on:click="search" title="In allen Nachrichten suchen">\n                                <i class="fa fa-search"></i>\n                            </button>\n                        </div>\n                        \n                    </div>\n                    <ul class="nav nav-tabs mt-3">\n                        <li class="nav-item pt-0">\n                            <a class="nav-link  pt-0 pb-0 active" data-toggle="pill" href="#viewlist">\n                                <i class="fa fa-list"></i>\n                            </a>\n                        </li>\n                        <li class="nav-item  pt-0">\n                            <a class="nav-link pt-0  pb-0" data-toggle="pill" href="#viewbubbles">\n                                <i class="fa fa-spinner"></i>\n                            </a>\n                        </li>\n                    </ul>\n                    <div class="tab-content">\n                        <div class="container-fluid px-2 border-left tab-pane active" id="viewlist">\n                            <div class="pt-4 pl-0">\n                                <div class="row" >\n                                \x3c!--\n                                    <div v-if="showMessageBody" class="d-block d-sm-none">\n                                        <messagebody-container \n                                            v-bind:courseid="courseid"\n                                            v-bind:postdata="singlepostdata"\n                                            :identiconstring = "identiconstring"\n                                            :isused ="msgbodycontainerdisplay" \n                                            :isreading="isreading" \n                                            :isanswering="isanswering" \n                                            :iscreatingtopic="iscreatingtopic"\n                                            :viewportsize = "viewportsize"\n                                            :hideloadingicon = "hideloadingiconRMB"\n                                            v-on:answeredmsg="onansweredmsg"\n                                            v-on:prevmsg="onprevmsg" \n                                            v-on:nextmsg="onnextmsg"\n                                            v-on:hideMessageBody="hideMessageBody"\n                                            >\n                                        </messagebody-container>\n                                    </div>\n                                --\x3e\n                                    <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12 border-right" id="tree" style="overflow-y:auto; overflow-x:hidden; margin-bottom:3px; height: auto" >\n                                        <div v-for="error in errorMessages" class="alert">\n                                            {{ error.errordescr }}\n                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                                <span aria-hidden="true">&times;</span>\n                                            </button>\n                                        </div>\n                                        <div v-if = "statesearchresult" class = "alert alert-success">\n                                            Ihre Suche hat {{ searchresultmsg }} Treffer erzielt\n                                            <button type="button" class="close" aria-label="Close" v-on:click = "showallposts">\n                                                <span aria-hidden="true">&times;</span>\n                                            </button>\n                                        </div>\n                                        <post-container \n                                            v-bind:courseid="courseid" \n                                            v-bind:postlist="post_list" \n                                            v-bind:markedpost="markedpost" \n                                            :showloadingicon="hideloadingicon"\n                                            :viewportsize = "viewportsize"\n                                            v-on:displaymsg="ondisplaymsg"\n                                            v-on:setSelected="setSelected">\n                                        </post-container>\n                                    </div>\n                                    <div class="col-xl-6 col-lg-6 col-md-12 d-none d-sm-inline" id="treeinfo">\n                                        \x3c!-- , {modal: showmodal} :class="[\'col-xl-6\', \'col-lg-6\', \'col-md-12\', \'col-sm-12\', \'col-12\']"--\x3e\n                                        <messagebody-container \n                                            v-bind:courseid="courseid" \n                                            v-bind:postdata="singlepostdata"\n                                            :identiconstring = "identiconstring"\n                                            :isused ="msgbodycontainerdisplay" \n                                            :isreading="isreading" \n                                            :isanswering="isanswering" \n                                            :iscreatingtopic="iscreatingtopic"\n                                            :viewportsize = "viewportsize"\n                                            :hideloadingicon = "hideloadingiconRMB"\n                                            :statesRMB = "statesRMB"\n                                            v-on:answeredmsg="onansweredmsg"\n                                            v-on:prevmsg="onprevmsg" \n                                            v-on:nextmsg="onnextmsg"\n                                            v-on:hideMessageBody="hideMessageBody">\n                                        </messagebody-container>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <viz-bubble v-bind:treedata="treedata_viz" class="tab-pane fade" id="viewbubbles"></viz-bubble>\n                    </div>\n                </div>\n            '})}}));
=======
define(["jquery",M.cfg.wwwroot+"/mod/newsmod/lib/build/vue.min.js",M.cfg.wwwroot+"/mod/newsmod/lib/build/axios.min.js",M.cfg.wwwroot+"/mod/newsmod/lib/build/identicon.min.js",M.cfg.wwwroot+"/mod/newsmod/amd/src/ReaderMessageBody.js",M.cfg.wwwroot+"/mod/newsmod/amd/src/ReaderPostContainer.js",M.cfg.wwwroot+"/mod/newsmod/amd/src/VizBubble.js"],(function(e,i,t,n,s,o,a){return function(r,d,c,h){var l=new i({el:"newsmod-container",data:function(){return{instanceName:"Newsgroup",showMessageBody:!1,searchstring:"",searchresult:[],hiddenposts:[],filter_assessment:!0,filter_text:!0,content:[],tree_data:"",treedata_viz:{},sequence:1,arraypos:0,post_list:[],singlepostdata:[],msgbodycontainerdisplay:"none",isreading:!1,isanswering:!1,iscreatingtopic:!1,markedpost:-1,courseid:d,hideloadingicon:!0,hideloadingiconRMB:!0,identiconstring:"",viewportsize:"none",showmodal:!1,displayerrormsg:!1,newsgroup_name:"",newsgroup_postquantity:0,fetch_postquantity:50,start:"830",end:"840",errorMessages:{}}},components:{"messagebody-container":s,"post-container":o,"viz-bubble":a},created:function(){this.instanceName=h,this.singlepostdata.header={name:"",subject:""},r.add("hello_world",{level:"fun",target:"vue is in place"}),e(".nav-link-h4").click((function(){r.add("toc_entry_open",{level:"h4",target:e(this).attr("href")})})),e(".nav-link-h3").click((function(){r.add("toc_entry_open",{level:"h3",target:e(this).attr("href")})})),window.addEventListener("resize",this.Windowresizehandler),Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)<576?this.viewportsize="mobile":this.viewportsize="other"},destroyed(){window.removeEventListener("resize",this.Windowresizehandler)},mounted:function(){this.getgroupinfo(),this.hideloadingicon=!1,t.get(M.cfg.wwwroot+"/mod/newsmod/php/phpconn5.php?id="+d).then((function(e){l.check_for_error(e.data)?l.post_list.push(l.prepare_postdata(e.data)):(l.treedata_viz=e.data.children,l.info=e,l.tree_data=e.data,l.buildtree(e.data,1))})).catch((function(e){console.error(e)})).then((function(){l.hideloadingicon=!0}))},computed:{},methods:{hideMessageBody:function(){this.showMessageBody=!1},Windowresizehandler:function(){Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)<576?(this.viewportsize="mobile",""==this.msgbodycontainerdisplay&&(this.showmodal=!0)):(this.viewportsize="other",this.showmodal=!1)},getgroupinfo:function(){t.get(M.cfg.wwwroot+"/mod/newsmod/php/groupinfo.php?id="+d).then((function(e){l.check_for_error(e.data)?l.post_list.push(l.prepare_postdata(e.data)):l.processgroupinfo(e.data)})).catch((function(e){console.error(e)}))},processgroupinfo:function(e){l.newsgroup_name=e.groupname,l.newsgroup_postquantity=e.lastarticle-e.firstarticle+1,l.start=parseInt(e.firstarticle),l.end=parseInt(e.lastarticle),t.get(M.cfg.wwwroot+"/mod/newsmod/php/fetchtree.php?id="+d+"&start="+l.start+"&end="+l.end).then((function(e){l.check_for_error(e.data)&&l.post_list.push(l.prepare_postdata(e.data))})).catch((function(e){console.error(e)}))},getMessageTree:function(){return this.tree_data.children},findinarr:function(e,i){for(let t=0;t<i.length;t++)if(i[t].messageid===e)return i[t]},ondisplaymsg:function(e){this.showMessageBody=!0,this.hideloadingiconRMB=!1,t.get(M.cfg.wwwroot+"/mod/newsmod/php/messageid.php?id="+d+"&msgnr="+e).then((function(e){l.check_for_error(e.data)?l.post_list.push(l.prepare_postdata(e.data)):(l.singlepostdata=e.data,l.identiconstring=l.getidenticon(l.singlepostdata.header.from+l.singlepostdata.header.name))})).catch((function(e){console.error(e)})).then((function(){l.hideloadingiconRMB=!0})),this.msgbodycontainerdisplay="",this.iscreatingtopic=!1,this.isreading=!0,this.isanswering=!1;let i=this.findinarr(e,this.post_list).arraypos;this.markedpost=i,"mobile"==this.viewportsize&&(this.showmodal=!0)},setSelected:function(e){this.markedpost=e},onprevmsg:function(e){this.hideloadingiconRMB=!1;let n=this.findinarr(e,this.post_list).arraypos;n-=1,this.markedpost=n,e=this.post_list[n].messageid;let s=this.findinarr(e,this.post_list);s.hidden=!1,i.set(this.post_list,n,s),t.get(M.cfg.wwwroot+"/mod/newsmod/php/messageid.php?id="+d+"&msgnr="+e).then((function(e){l.check_for_error(e.data)?l.post_list.push(l.prepare_postdata(e.data)):(l.singlepostdata=e.data,l.identiconstring=l.getidenticon(l.singlepostdata.header.from+l.singlepostdata.header.name))})).catch((function(e){console.error(e)})).then((function(){l.hideloadingiconRMB=!0})),this.msgbodycontainerdisplay="",this.iscreatingtopic=!1,this.isreading=!0,this.isanswering=!1},onnextmsg:function(e){this.hideloadingiconRMB=!1;let n=this.findinarr(e,this.post_list).arraypos;n+=1,this.markedpost=n,e=this.post_list[n].messageid;let s=this.findinarr(e,this.post_list);s.hidden=!1,i.set(this.post_list,n,s),t.get(M.cfg.wwwroot+"/mod/newsmod/php/messageid.php?id="+d+"&msgnr="+e).then((function(e){l.check_for_error(e.data)?l.post_list.push(l.prepare_postdata(e.data)):(l.singlepostdata=e.data,l.identiconstring=l.getidenticon(l.singlepostdata.header.from+l.singlepostdata.header.name))})).catch((function(e){console.error(e)})).then((function(){l.hideloadingiconRMB=!0})),this.msgbodycontainerdisplay="",this.iscreatingtopic=!1,this.isreading=!0,this.isanswering=!1},onansweredmsg:function(){this.hideloadingicon=!1,l.post_list.splice(0),this.arraypos=0,this.msgbodycontainerdisplay="none",this.isanswering=!1,this.iscreatingtopic=!1,this.isreading=!1;let e=this;setTimeout((function(){e.refresh}),2e3)},prepare_postdata:function(e,i=1){var t,n="0"!=e.markedstatus,s="0"==e.messagestatus,o=!1;if(e.picturestatus>"0")t=M.cfg.wwwroot+"/user/pix.php/"+e.user_id+"/f1.jpg";else{var a={background:[255,255,255,255],margin:.05,size:20,format:"svg"};t=this.getidenticon(e.sender+e.personal)}if(o=!!e.children,!e.children);var r=new Date(e.date);a={year:"numeric",month:"2-digit",day:"2-digit"};r=new Date(e.date).toLocaleDateString("de-DE",a)?new Date(e.date).toLocaleDateString("de-DE",a):"";var d,c=e.personal?e.personal:e.sender;return e.children&&(d=this.getfamily(e)),{marked:n,unread:s,markedhtml:n,picturestatus:e.picturestatus,personal:e.personal,sender:e.sender,user_id:e.user_id,margin:i,sequence:this.sequence++,messageid:e.messageid,date:e.date,subject:e.name,calctime:r,absender:c,haschild:o,arraypos:this.arraypos++,isSelected:!1,hidden:!1,family:d,identicon:t}},buildtree:function(e,i){void 0===e.children&&console.error("tree_data.children not defined",e),e.children.forEach(e=>{let t=this.prepare_postdata(e,i);this.post_list.push(t),e.children&&l.buildtree(e,i+15)})},getfamily:function(e){var i=[];if(e.children){var t=e.children.length;for(let n=0;n<t;n++)i.push(e.children[n].messageid),e.children[n].children&&i.push(l.getfamily(e.children[n]))}return i},newTopic:function(){this.msgbodycontainerdisplay="",this.showMessageBody=!0,this.iscreatingtopic=!0,this.isreading=!1,this.isanswering=!1},search:function(e){this.hideallposts(),this.hideloadingicon=!1,t.get(M.cfg.wwwroot+"/mod/newsmod/php/search.php?id="+d+"&searchparam="+this.searchstring).then((function(e){l.check_for_error(e.data)?(l.post_list.push(l.prepare_postdata(e.data)),l.displayerrormsg=!0):l.displaysearchresult("",e.data)})).catch(e=>console.error(e)).then((function(){l.hideloadingicon=!0}))},hideallposts:function(){for(let e=0;e<this.post_list.length;e++){let t=this.post_list[e];t.hidden=!0,i.set(this.post_list,e,t)}},showallposts:function(){for(let e=0;e<this.post_list.length;e++){let t=this.post_list[e];t.hidden=!1,i.set(this.post_list,e,t)}},displaysearchresult:function(e,t){this.hideallposts();for(let e=0;e<t.length;e++){this.hiddenposts.push(this.findinarr(t[e].messagenum,this.post_list));let n=this.hiddenposts[e];void 0!==n.hidden?(n.hidden=!1,i.set(this.post_list,n.arraypos,n)):console.error("error displaysearchresult")}},resetsearchstring:function(){this.searchstring="",this.hiddenposts.splice(0),this.displayerrormsg&&(this.post_list.pop(),this.arraypos--,this.displayerrormsg=!1),this.showallposts()},refresh:function(){this.hideloadingicon=!1,this.isreading=!1,this.isanswering=!1,this.msgbodycontainerdisplay="none",this.markedpost=-1,this.arraypos=0,this.post_list.splice(0),"mobile"==this.viewportsize&&(this.showmodal=!1),t.get(M.cfg.wwwroot+"/mod/newsmod/php/phpconn5.php?id="+d).then((function(e){l.check_for_error(e.data)?l.post_list.push(l.prepare_postdata(e.data)):(l.treedata_viz=e.data.children,l.info=e,l.tree_data=e.data,l.buildtree(e.data,1))})).catch((function(e){console.error(e)})).then((function(){l.hideloadingicon=!0}))},getidenticon:function(e){var i=this.hash64(e,!0);return"data:image/svg+xml;base64,"+new n(i,{background:[255,255,255,0],margin:.05,size:20,format:"svg"}).toString()},hash32:function(e,i,t){var n,s,o=void 0===t?2166136261:t;for(n=0,s=e.length;n<s;n++)o^=e.charCodeAt(n),o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24);return i?("0000000"+(o>>>0).toString(16)).substr(-8):o>>>0},hash64:function(e,i){var t=this.hash32(e,i);return t+this.hash32(t+e,i)},check_for_error:function(e){return void 0!==e.is_error}},template:'\n                <div id="newsmod-container">\n                    <h3 class="mb-4"><img style="width:30px; height:30px;" src="pix/icon.svg"> {{ instanceName }}</h3>\n                    <div class="d-flex">\n                        <div class="d-flex mr-auto">\n                            <button class="btn btn-primary btn-sm" :disabled="iscreatingtopic" v-on:click="newTopic" title="Eine neue Nachricht erstellen">\n                                <i class="fa fa-pen"></i>\n                                Neue Nachricht\n                            </button>\n\n                            <button class="btn btn-light btn-sm" v-on:click="refresh" title="Neue Nachrichten abholen">\n                                    <i class="fa fa-sync"></i>\n                                    <span class="d-none d-md-inline">aktualisieren</span>\n                            </button>\n                        </div>\n                        <div class="search d-flex">\n                            <input \n                                class="form-control form-control-sm d-inline ml-2" \n                                v-model="searchstring" \n                                placeholder="Suchen..." \n                                v-on:keyup.enter="search"\n                                :style="[ viewportsize===\'mobile\' ? {width:70+\'%\'} : {width:150+\'px\'} ]"\n                                >\n\n                            <button class="btn btn-light btn-sm" type="submit" v-on:click="search" title="In allen Nachrichten suchen">\n                                <i class="fa fa-search"></i>\n                            </button>\n                        </div>\n                        \n                    </div>\n                    <ul class="nav nav-tabs mt-3">\n                        <li class="nav-item pt-0">\n                            <a class="nav-link  pt-0 pb-0 active" data-toggle="pill" href="#viewlist">\n                                <i class="fa fa-list"></i>\n                            </a>\n                        </li>\n                        <li class="nav-item  pt-0">\n                            <a class="nav-link pt-0  pb-0" data-toggle="pill" href="#viewbubbles">\n                                <i class="fa fa-spinner"></i>\n                            </a>\n                        </li>\n                    </ul>\n                    <div class="tab-content">\n                        <div class="container-fluid px-2 border-left tab-pane active" id="viewlist">\n                            <div class="pt-4 pl-0">\n                                <div class="row" >\n                                    <div v-if="showMessageBody" class="d-block d-sm-none">\n                                        <messagebody-container \n                                            v-bind:courseid="courseid"\n                                            v-bind:postdata="singlepostdata"\n                                            :identiconstring = "identiconstring"\n                                            :isused ="msgbodycontainerdisplay" \n                                            :isreading="isreading" \n                                            :isanswering="isanswering" \n                                            :iscreatingtopic="iscreatingtopic"\n                                            :viewportsize = "viewportsize"\n                                            :hideloadingicon = "hideloadingiconRMB"\n                                            v-on:answeredmsg="onansweredmsg"\n                                            v-on:prevmsg="onprevmsg" \n                                            v-on:nextmsg="onnextmsg"\n                                            v-on:hideMessageBody="hideMessageBody"\n                                            >\n                                        </messagebody-container>\n                                    </div>\n                                    <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12 border-right" id="tree" style="overflow-y:auto; overflow-x:hidden; margin-bottom:3px; height: auto" >\n                                        <div v-for="error in errorMessages" class="alert">{{ e }}</div>\n                                        <post-container \n                                            v-bind:courseid="courseid" \n                                            v-bind:postlist="post_list" \n                                            v-bind:markedpost="markedpost" \n                                            :showloadingicon="hideloadingicon"\n                                            :viewportsize = "viewportsize"\n                                            v-on:displaymsg="ondisplaymsg"\n                                            v-on:setSelected="setSelected">\n                                        </post-container>\n                                    </div>\n                                    <div class="col-xl-6 col-lg-6 col-md-12 d-none d-sm-inline" id="treeinfo">\n                                        \x3c!-- , {modal: showmodal} :class="[\'col-xl-6\', \'col-lg-6\', \'col-md-12\', \'col-sm-12\', \'col-12\']"--\x3e\n                                        <messagebody-container \n                                            v-bind:courseid="courseid" \n                                            v-bind:postdata="singlepostdata"\n                                            :identiconstring = "identiconstring"\n                                            :isused ="msgbodycontainerdisplay" \n                                            :isreading="isreading" \n                                            :isanswering="isanswering" \n                                            :iscreatingtopic="iscreatingtopic"\n                                            :viewportsize = "viewportsize"\n                                            :hideloadingicon = "hideloadingiconRMB"\n                                            v-on:answeredmsg="onansweredmsg"\n                                            v-on:prevmsg="onprevmsg" \n                                            v-on:nextmsg="onnextmsg"\n                                            v-on:hideMessageBody="hideMessageBody">\n                                        </messagebody-container>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <viz-bubble v-bind:treedata="treedata_viz" class="tab-pane fade" id="viewbubbles"></viz-bubble>\n                    </div>\n                </div>\n            '})}}));
>>>>>>> 893a1fdc2935d9712f29c2a6169c3a7c76305627
