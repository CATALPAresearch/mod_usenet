/**
 * 
 *
 * @module     mod_usenet
 * @class      Message body
 * @copyright  Niels Seidel <niels.seidel@fernuni-hagen.de> AND Konstantin Friedrich
 * @license    GNU GPLv3
 */
define([M.cfg.wwwroot+"/mod/usenet/lib/build/vue.min.js",M.cfg.wwwroot+"/mod/usenet/lib/build/axios.min.js"],(function(e,t){return e.component("messagebody-container",{props:["postdata","isused","isreading","isanswering","iscreatingtopic","courseid","identiconstring","hideloadingicon","statesRMB","log"],data:function(){return{textareacontent:"",value:{},usrinput_subject:"",textarea_usrinput:""}},methods:{logger:function(e,t){this.$emit("log",e,t)},replyMessage:function(){this.isreading=!1,this.isanswering=!0;for(var e=this.textareacontent.split("\n"),t="\n",n=0;n<e.length;n++)t=t+">"+e[n]+"\n";this.textarea_usrinput=t,this.$nextTick(()=>this.$refs.replyText.focus())},previousMessage:function(){this.$emit("prevmsg",void 0!==this.postdata.header?this.postdata.header.messagenumber:0)},nextMessage:function(){this.$emit("nextmsg",void 0!==this.postdata.header?this.postdata.header.messagenumber:0)},hideParentMessageBody:function(){this.$emit("hideMessageBody"),this.$emit("log","message_body_panel_close",{})},submitNewMessage:function(){this.$emit("log","message_body_panel_submit_new",{});const e=new URLSearchParams;e.append("userInput",this.textarea_usrinput),e.append("subject",this.usrinput_subject),t.post(M.cfg.wwwroot+"/mod/usenet/php/posttest.php?id="+this.courseid+"&msgnr=new",e).then(e=>this.value=e),this.$emit("answeredmsg")},submitReplyMessage:function(){this.isreading=!0,this.isanswering=!1;const e=new URLSearchParams;e.append("userInput",this.textarea_usrinput),void 0===this.postdata.header&&(this.postdata.header={subject:"",references:"",id:-1}),e.append("subject",this.postdata.header.subject),e.append("references",this.postdata.header.references),e.append("uid",this.postdata.header.id),t.post(M.cfg.wwwroot+"/mod/usenet/php/posttest.php?id="+this.courseid+"&msgnr="+this.postdata.header.id,e).then(e=>this.value=e),this.$emit("answeredmsg")},convertDate:function(e){e*=1e3;var t={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric"};return new Date(e).toLocaleDateString("de-DE",t)?new Date(e).toLocaleDateString("de-DE",t):""}},watch:{postdata:function(){this.textareacontent=this.postdata.messagebody,this.isreading=!0,this.isanswering=!1},iscreatingtopic:function(){this.iscreatingtopic&&(this.textarea_usrinput="")},hideloadingicon:function(){0==this.hideloadingicon&&(this.textareacontent="")}},template:'\n                <div :class="{\'messagebody-container\': true}" :style="{display: isused}">\n                   \n                    \x3c!-- Create new message --\x3e\n                    <template v-if="iscreatingtopic">\n                        <div class="border-bottom ml-3 mb-1 pl-1 pb-1">\n                            <div class="mb-2 pl-1 pb-1">\n                                <div class="mx-0 control-bar">\n                                    <span class="bold">Neue Nachricht verfassen</span>\n                                    <button type="button" class="close ml-auto align-self-center d-block d-sm-none" aria-label="Close" v-on:click="hideParentMessageBody">\n                                        <span aria-hidden="true">&times;</span>\n                                    </button>\n                                </div>\n                            </div>\n                            <div class="form-group">\n                                <label hidden for="inputsubject">Betreff:</label>\n                                <input ref="newMessageSubject" id="inputsubject" placeholder="Betreff" v-model="usrinput_subject" :class="{\'form-control\': true}"/>\n                            </div>\n                            <div class="form-group">\n                                <label hidden for="inputtext">Text:</label>\n                                <textarea id="inputtext" placeholder="Beitragstext" v-model="textarea_usrinput" :class="{\'form-control\': true, hidden: isreading}" cols=90 rows=10> </textarea>\n                                <button class="btn btn-sm btn-primary mt-1" :disabled="isanswering" v-on:click="submitNewMessage">Senden</button>\n                                <button class="btn btn-sm btn-link mt-1 float-right d-block d-sm-none" v-on:click="hideParentMessageBody">Nachricht verwerfen</button>\n                            </div>\n                        </div>\n                    </template>\n\n\n                    \x3c!-- Read single message --\x3e\n                    <template v-else>\n                        <div class="border-bottom ml-3 mb-1 pl-1 pb-1">\n                            <div class="mx-0 mb-3 control-bar">\x3c!-- :class="{hidden: postdata.header.is_error}" --\x3e\n                                <button class="btn btn-sm btn-outline-primary mr-3" :hidden="isanswering" v-on:click="replyMessage" title="Beitrag beantworten">\n                                    <i class="fa fa-reply"></i>\n                                    Antworten\n                                </button>\n                                <button class="btn btn-sm btn-light mr-0" :disabled = "!statesRMB.CanSelectPrev" v-on:click="previousMessage" title="Die vorherige Nachricht anzeigen">\n                                    <i class="fa fa-chevron-left"></i>\n                                </button>\n                                <span class="mx-0">Nachricht</span>\n                                <button class="btn btn-sm btn-light ml-0" :disabled = "!statesRMB.CanSelectNext" v-on:click="nextMessage" title="Die nÃ¤chste Nachricht anzeigen">\n                                    <i class="fa fa-chevron-right"></i>    \n                                </button>\n                                <button type="button" class="close ml-auto align-self-center d-block d-sm-none" aria-label="Close" v-on:click="hideParentMessageBody">\n                                    <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>\n                            <div>\n                                <div v-if="postdata.header !== undefined">\n                                    <div class="d-flex">\n                                        <img style="height:40px; width:40px;" :src="postdata.header.identicon"/>\n                                        <span class="mr-auto pt-1" >\n                                            <a :href="\'mailto:\' + postdata.header.sender">{{postdata.header.personal}}</a>\n                                        </span>\n                                        <span class="pt-1">{{ convertDate(postdata.header.timestamp) }}</span>\n                                    </div>\n                                    <div class="bold">\n                                        {{postdata.header.subject}}\n                                    </div>\n                                </div>\n                                \n                            </div>\n                        </div>\n                    </template>\n                        \n\n                    <template v-if="! iscreatingtopic">\n                        <template v-if="isreading">\n                            <div :class="{hidden: hideloadingicon, \'text-center\': true, \'my-2\': true}" style="opacity:0.5;">\n                                <i class="fas fa-circle-o-notch fa-spin fa-3x"/>\n                            </div>\n                            <div class="border-bottom ml-3 mb-3 pl-1 pb-3" :style="{\'white-space\': \'pre-line\'}">\n                                {{textareacontent}}\n                            </div>\n                        </template>\n                        <template v-else>\n                            <div class="form-group ml-3 mb-3 pl-1 pb-3">\n                                <textarea ref="replyText" v-model="textarea_usrinput" :class="{\'form-control\': true, hidden: isreading}" cols=90 rows=10></textarea>\n                                <button class="btn btn-sm mt-3 btn-primary" v-on:click="submitReplyMessage">Absenden</button>\n                                <button class="btn btn-sm mt-3 btn-link float-right d-block d-sm-none" v-on:click="hideParentMessageBody">Nachricht verwerfen</button>\n                            </div>\n                        </template>\n                    </template>                        \n                </div>\n            '})}));