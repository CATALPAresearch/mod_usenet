define(["jquery",M.cfg.wwwroot+"/mod/newsmod/lib/build/vue.min.js",M.cfg.wwwroot+"/mod/newsmod/lib/build/axios.min.js"],(function(t,e,n){return e.component("messagebody-container",{props:["postdata","isused","isreading","isanswering","iscreatingtopic","courseid","identiconstring","viewportsize","hideloadingicon"],data:function(){return{answerbuttontext:"Antworten",textareacontent:"",value:"",usrinput_subject:"",textarea_usrinput:"",ismobile:!1}},created:function(){"mobile"==this.viewportsize?this.ismobile=!0:this.ismobile=!1},methods:{onanswerbuttonclick:function(){if(this.answerbuttontext="Antworten"==this.answerbuttontext?"Senden":"Antworten",this.isreading){this.isreading=!1,this.isanswering=!0;for(var t=this.textareacontent.split("\n"),e="\n",i=0;i<t.length;i++)e=e+">"+t[i]+"\n";this.textarea_usrinput=e}else{this.isreading=!0,this.isanswering=!1;const t=new URLSearchParams;t.append("userInput",this.textarea_usrinput),void 0===this.postdata.header&&(this.postdata.header={subject:"",references:"",id:-1}),t.append("subject",this.postdata.header.subject),t.append("references",this.postdata.header.references),t.append("uid",this.postdata.header.id),n.post(M.cfg.wwwroot+"/mod/newsmod/php/posttest.php?id="+this.courseid+"&msgnr="+this.postdata.header.id,t).then(t=>this.value=t),this.$emit("answeredmsg")}},convertDate:function(t){console.log(t),t*=1e3;var e={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric"};return new Date(t).toLocaleDateString("de-DE",e)?new Date(t).toLocaleDateString("de-DE",e):""},prevmsg:function(){this.$emit("prevmsg",void 0!==this.postdata.header?this.postdata.header.number:0)},nextmsg:function(){this.$emit("nextmsg",void 0!==this.postdata.header?this.postdata.header.number:0)},closemodal:function(){this.$emit("closemodal")},createtopic:function(){const t=new URLSearchParams;t.append("userInput",this.textarea_usrinput),t.append("subject",this.usrinput_subject),n.post(M.cfg.wwwroot+"/mod/newsmod/php/posttest.php?id="+this.courseid+"&msgnr=new",t).then(t=>this.value=t),this.$emit("answeredmsg")}},watch:{postdata:function(){this.textareacontent=this.postdata.messagebody,this.isreading=!0,this.isanswering=!1,this.answerbuttontext="Antworten"},iscreatingtopic:function(){this.iscreatingtopic&&(this.textarea_usrinput="")},viewportsize:function(){"mobile"==this.viewportsize?this.ismobile=!0:this.ismobile=!1},hideloadingicon:function(){0==this.hideloadingicon&&(this.textareacontent="")}},template:'\n                <div :class="{\'messagebody-container\': true}" :style="{display: isused}">\n                    <div class="" style="padding-right:0px">\n                        <div class="">\n                            \n                            \x3c!-- Create new message --\x3e\n                            <template v-if="iscreatingtopic">\n                                <div class="mb-2 pl-1 pb-1">\n                                    <div class="mx-0 control-bar">\n                                        <button :class="\'btn btn-sm btn-primary\'" v-on:click="createtopic">\n                                        Senden</button>\n                                        <template v-if="ismobile">\n                                            <button class="fas fa-times ml-auto align-self-center" v-on:click="closemodal"\n                                            style="margin-right: 30px">\n                                            </button>\n                                        </template>\n                                    </div>\n                                </div>\n                                <div class="form-group">\n                                    <label hidden for="inputsubject">Betreff:</label>\n                                    <input id="inputsubject" placeholder="Betreff" v-model="usrinput_subject" :class="{\'form-control\': true}"/>\n                                </div>\n                                <div class="form-group">\n                                    <label hidden for="inputtext">Text:</label>\n                                    <textarea id="inputtext" placeholder="Beitragstext" v-model="textarea_usrinput" :class="{\'form-control\': true, hidden: isreading}" cols=90 rows=10> </textarea>\n                                </div>\n                            </template>\n\n                            \x3c!-- Read message --\x3e\n                            <template v-else>\n                            <div class="bg-infoX border-bottom mb-2 pl-1 pb-1">\n                                <div class="mx-0 mb-3 control-bar" :class="{hidden: postdata.header.is_error}">\n                                    <button class="btn btn-sm btn-outline-primary mr-3" v-on:click="onanswerbuttonclick" title="Beitrag beantworten">\n                                        <i class="fa fa-reply"></i>\n                                        {{answerbuttontext}}\n                                    </button>\n                                    <button class="btn btn-sm btn-light mr-1" v-on:click="prevmsg" title="Die vorherige Nachricht anzeigen">\n                                        <i class="fa fa-arrow-left"></i>\n                                        Vorherige Nachricht\n                                    </button>\n                                    <button class="btn btn-sm btn-light" v-on:click="nextmsg" title="Die nächste Nachricht anzeigen">\n                                        Nächste Nachricht \n                                        <i class="fa fa-arrow-right"></i>    \n                                    </button>\n                                </div>\n                                <div class="">\n                                    <div>\n                                        <div class="d-flex">\n                                            <img style="height:40px; width:40px;" :src="this.identiconstring"/>\n                                            <span class="mr-auto pt-1" >\n                                                <a :href="\'mailto:\' + postdata.header.from">{{postdata.header.name}}</a>\n                                            </span>\n                                            <span class="pt-1">{{ convertDate(postdata.header.date) }}</span>\n                                        </div>\n                                        <div class="bold">\n                                            {{postdata.header.subject}}\n                                        </div>\n                                    </div>\n                                    <template v-if="ismobile">\n                                        <button class="fas fa-times ml-auto align-self-center" v-on:click="closemodal">\n                                        </button>\n                                        \x3c!-- \n                                        <button type="button" class="close ml-auto align-self-center" aria-label="Close" v-on:click="closemodal">\n                                            <span aria-hidden="true">&times;</span>\n                                        </button>\n                                        --\x3e\n                                    </template>\n                                </div>\n                            </div>\n                            </template>\n                        </div>\n                    </div>\n\n                    <template v-if="iscreatingtopic"></template>\n\n                    <template v-else>\n                        \n                        <template v-if="isreading">\n                            <div :class="{hidden: hideloadingicon}">\n                                <i class="fas fa-cog fa-spin fa-5x"/>\n                            </div>\n                            <div class="">\n                                \x3c!-- \'white-space\': \'pre-line\' is needed here because v-model automatically formats nl it seems --\x3e\n                                <p :style="{\'white-space\': \'pre-line\', \'overflow\': \'auto\', \'height\': \'auto\'}"> {{textareacontent}}</p>\n                            </div>\n                        </template>\n                        <template v-else>\n                            <div class="form-group">\n                                <textarea v-model="textarea_usrinput" :class="{\'form-control\': true, hidden: isreading}" cols=90 rows=10> </textarea>\n                            </div>\n                        </template>\n                    </template>                        \n                </div>\n            '})}));