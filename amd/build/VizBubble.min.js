/**
 *
 *
 * @module     mod_usenet
 * @class      Visualize messages in a bubble chart
 * @copyright  Niels Seidel <niels.seidel@fernuni-hagen.de>
 * @license    GNU GPLv3
 */
define(["jquery",M.cfg.wwwroot+"/mod/usenet/lib/build/vue.min.js",M.cfg.wwwroot+"/mod/usenet/lib/src/d3.v5.js"],(function(t,e,a){return e.component("post",{props:["treedata","log"],data:function(){return{isSelected:!1}},watch:{treedata:function(){this.createBubbleChart()}},mounted:function(){},methods:{createBubbleChart:function(){let t,e,r,n=[];a.timeFormatDefaultLocale({decimal:",",thousands:".",grouping:[3],currency:["€",""],dateTime:"%a %b %e %X %Y",date:"%d.%m.%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["Jänner","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var i=a.timeParse("%a, %e %b %Y %H:%M:%S %Z"),o=a.timeParse("%a, %e %b %Y %H:%M:%S %Z (UTC)");for(var s in this.treedata)this.treedata[s].count=void 0===this.treedata[s].children?10:10*this.treedata[s].children.length,this.treedata[s].time=i(this.treedata[s].date)||o(this.treedata[s].date),null!==this.treedata[s].time?(this.treedata[s].id=s,n.push(this.treedata[s])):console.log("warning: could not convert usenet date string into date object: ",this.treedata[s].date,this.treedata[s]);let c,l,d,u;l=a.scaleLinear().domain([1,Math.max.apply(Math,n.map(t=>t.count))]).range([5,40]),d=a.scaleSequential().domain([0,100]).interpolator(a.interpolateRainbow),u=a.scaleLinear().domain([0,100]).range([0,350]),t=n.map(t=>{let e=function t(e){if(void 0===e.children||0===e.children.length)return 0;let a=e.children.length;for(var r=0;r<e.children.length;r++)a+=t(e.children[r]);return a}(t);return{id:t.id,name:t.name,date:t.time,threads:e,radius:l(4*e),fill:d(t.count),x:600*Math.random(),y:u(t.count)}}),t.sort((t,e)=>e.date-t.date),a.select("#chart").append("svg").attr("height",350).attr("width",600),e=a.select("#chart svg").selectAll("circle").data(t).enter().append("circle").attr("id",t=>"circle-"+t.id).attr("r",t=>t.radius).attr("fill",t=>"#17a2b8").attr("stroke",t=>"#fff").style("cursor","pointer").on("mouseover",(function(t){h.transition().duration(200),h.style("opacity",1).html("<strong>"+t.name+"</strong><br/>"+t.threads+" Beiträge<br/>").style("left",a.mouse(this)[0]-30+"px").style("top",a.mouse(this)[1]+140+"px"),a.select("#circle-"+t.id).attr("fill","#008fac")})).on("mousemove",(function(t){h.style("left",a.mouse(this)[0]-30+"px").style("top",a.mouse(this)[1]+140+"px")})).on("mouseleave",(function(t){h.transition().duration(200).style("opacity",0),a.select("#circle-"+t.id).attr("fill","#17a2b8").attr("r",t.radius)})),r=a.select("#chart svg").selectAll("text").data(t).enter().append("text").text((function(t){return t.threads})).attr("color","#fff").attr("fill","#fff").attr("font-size",9).attr("text-anchor","middle");var h=a.select("#chart").append("div").style("opacity",0).attr("class","tooltip").style("background-color","white").style("border-radius","5px").style("padding","4px").style("color","black");c=a.forceSimulation().nodes(t).velocityDecay(.15).on("tick",(function(){e.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})),r.attr("x",t=>t.x).attr("y",t=>t.y)})).force("x",a.forceX().strength(.03).x(300)).force("y",a.forceY().strength(.03).y(175)).force("charge",a.forceManyBody().strength((function(t){return.03*-Math.pow(t.radius,2)})))}},template:'\n                <div>\n                    <div id="chart"></div>\n                </div>\n                '})}));